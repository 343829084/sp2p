#{extends 'common/frontMain.html' /}
%{
business.BackstageSet  currBackstageSet = business.BackstageSet.getCurrentBackstageSet();
}%
#{set title:currBackstageSet.seoTitle + '--注册' /}
<head>
    <link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/new_css/common.css'}"/>
    <link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/new_css/register.css'}"/>
    <script type="text/javascript" src="@{'/public/javascripts/common.js'}"></script>
</head>
<div id="main">
    <hr class="top-cutting-line" size="3">
    <div class="register-container">
        <div class="header">
            <span class="company-name">注册金豆荚理财</span>
            <span class="note">如果您已拥有金豆荚理财账号，可点击此</span>
            <a>登录</a>
        </div>
        <div class="body clearfix">
            <div class="advertisement">

            </div>
            <div class="form">
            #{form @front.account.loginAndRegisterAction.registering(), id:'submit'}
                <div>
                    <label for="userName">手机号码</label>
                    <input type="text" name="userName" id="userName" value="${flash?.userName}" placeholder="请输入手机号码"/>
                    <span id="userName_error"></span>
                </div>

                <div class="security-code">
                    <label for="securityCode">验证码</label>
                    <input type="text" name="code" id="verifyCode" value="${flash?.code}" placeholder="请输入验证码"/>
                    <a onclick="getVerifyCode()">获取验证码</a>
                </div>

                <div>
                    <label for="password">设置密码</label>
                    <input type="text" name="password" id="password" value="${flash?.password}"
                           placeholder="请输入登录密码 6-20位字符组成"/>
                </div>
                <div>
                    <label for="confirmPassword">设置密码</label>
                    <input type="text" name="confirmPassword" id="confirmPassword" value="${flash?.confirmPassword}"
                           placeholder="请输入登录密码 6-20位字符组成"/>
                </div>

                <div>
                    <label for="invitaionCode">邀请码</label>
                    <input type="text" name="code" id="invitaionCode" placeholder="请输入邀请码（推荐人手机号）"/>
                </div>

                <div class="agreed-deal">
                    <input id="agreement" name="agreement" class="check-box" type="checkbox" checked="true"/>
                    <span>我已阅读并同意<a onclick="showProtocol()">《${currBackstageSet?.platformName}用户注册协议》</a></span>
                </div>
                <div>
                    <a onClick="register()" class="submit-btn">注 册</a>
                </div>
            #{/form}
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    function showProtocol() {

        showDiv($("#xf_mem_zc_xytc"));
    }

    function getVerifyCode() {
        var verifyCodeRoute = #{jsRoute @front.account.LoginAndRegisterAction.getVerifyCode() /}
        var mobile = $("#userName").val();
        if ('' == mobile || '手机号码即为用户名' == mobile) {
            alert("手机号不能为空");
        } else {
            $.ajax({
                url: verifyCodeRoute.url(),
                type: verifyCodeRoute.method,
                data: 'userName=' + mobile,
                success: function (data) {
                    if (0 == data.code) {
                        alert(data.msg);
                    } else {
                        alert('验证码发送失败：' + data.msg);
                    }
                },
                error: function () {
                    alert("对不起，出现错误!");
                }
            });
        }

    }

</script>

<script type="text/javascript">

    $(function () {
        $("#userName").blur();
        if ($("#userName").val() == '') {
            $("#userName").val("手机号码即为用户名");
        }

        $("#userName").focus(function () {

            if ($(this).val() == "手机号码即为用户名") {
                $(this).val("");
            }
        }).blur(function () {

            if ($(this).val() == '') {
                $(this).val("手机号码即为用户名");
            }
        });

    });

    var bName = 0;
    var bEmail = 0;
    var bRecommended = 0;
    //     var bCode = 0;

    $(document).ready(function () {
        $("form :input").blur(function () {

            if ($(this).attr("id") == "userName") {

                if (this.value == "" || this.value == "手机号码即为用户名") {
                    $("#s_userName").removeClass("xf_register_intext");
                    $("#s_userName").removeClass("xf_register_intext3");
                    $("#s_userName").addClass("xf_register_intext1");
                    $("#s_userName").html("请填写手机号码");
                } else if (!/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(this.value)) {
                    $("#s_userName").removeClass("xf_register_intext");
                    $("#s_userName").removeClass("xf_register_intext3");
                    $("#s_userName").addClass("xf_register_intext1");
                    $("#s_userName").html("手机号码不能含有特殊字符");
                } else if (!this.value.isMobileNum()) {
                    $("#s_userName").removeClass("xf_register_intext");
                    $("#s_userName").removeClass("xf_register_intext3");
                    $("#s_userName").addClass("xf_register_intext1");
                    $("#s_userName").html("请输入正确的手机号码");
                } else {
                    var name = this.value;
                    var hasNameExist = #{jsAction @front.account.loginAndRegisterAction.hasNameExist(':name')/}
                            $.post(hasNameExist({name: encodeURI(name)}), function (data) {

                                var arr = eval(data);

                                if (arr.error.code < 0) {
                                    bName = -1;
                                    $("#s_userName").removeClass("xf_register_intext");
                                    $("#s_userName").removeClass("xf_register_intext3");
                                    $("#s_userName").addClass("xf_register_intext1");
                                    $("#s_userName").html(arr.error.msg);
                                } else {
                                    bName = 0;
                                    $("#s_userName").removeClass("xf_register_intext1");
                                    $("#s_userName").removeClass("xf_register_intext");
                                    $("#s_userName").addClass("xf_register_intext3");
                                    $("#s_userName").html("该手机号码可以使用");
                                }
                            });
                }

            }

            if ($(this).attr("id") == "email") {
                var email = this.value;
                var result;

                if (this.value == "") {
                    $("#s_email").removeClass("xf_register_intext");
                    $("#s_email").removeClass("xf_register_intext3");
                    $("#s_email").addClass("xf_register_intext1");
                    $("#s_email").html("请填写邮箱地址");
                } else if (!(this.value).isEmail()) {
                    $("#s_email").removeClass("xf_register_intext");
                    $("#s_email").removeClass("xf_register_intext3");
                    $("#s_email").addClass("xf_register_intext1");
                    $("#s_email").html("请填写正确的邮箱地址");
                } else if (this.value.isQQEmail()) {
                    $("#s_email").removeClass("xf_register_intext1");
                    $("#s_email").removeClass("xf_register_intext3");
                    $("#s_email").addClass("xf_register_intext");
                    $("#s_email").html("不建议使用QQ邮箱注册");
                } else {
                    var hasEmailExist = #{jsAction @front.account.loginAndRegisterAction.hasEmailExist(':email')/}
                            $.post(hasEmailExist({email: email}), function (data) {
                                var arr = eval(data);

                                if (arr.error.code < 0) {
                                    bEmail = -1;
                                    $("#s_email").removeClass("xf_register_intext");
                                    $("#s_email").removeClass("xf_register_intext3");
                                    $("#s_email").addClass("xf_register_intext1");
                                    $("#s_email").html(arr.error.msg);
                                } else {
                                    bEmail = 0;
                                    $("#s_email").removeClass("xf_register_intext1");
                                    $("#s_email").removeClass("xf_register_intext");
                                    $("#s_email").addClass("xf_register_intext3");
                                    $("#s_email").html("邮箱用来处理账单及找回密码");
                                }
                            });
                }

            }

            if ($(this).attr("id") == "password") {

                if (this.value == "") {
                    $("#s_password").removeClass("xf_register_intext");
                    $("#s_password").removeClass("xf_register_intext3");
                    $("#s_password").addClass("xf_register_intext1");
                    $("#s_password").html("请设置您的密码");
                } else if (this.value.length < 6) {
                    $("#s_password").removeClass("xf_register_intext");
                    $("#s_password").removeClass("xf_register_intext3");
                    $("#s_password").addClass("xf_register_intext1");
                    $("#s_password").html("密码长度为6-20个字符");
                } else if (this.value.length > 20) {
                    $("#s_password").removeClass("xf_register_intext");
                    $("#s_password").removeClass("xf_register_intext3");
                    $("#s_password").addClass("xf_register_intext1");
                    $("#s_password").html("密码长度为6-20个字符");
                } else if (!/^([^\s'‘’]{6,20})$/.test(this.value)) {
                    $("#s_password").removeClass("xf_register_intext");
                    $("#s_password").removeClass("xf_register_intext3");
                    $("#s_password").addClass("xf_register_intext1");
                    $("#s_password").html("密码由6-20位字符组成（不含'）");
                }
                else {
                    $("#s_password").removeClass("xf_register_intext1");
                    $("#s_password").removeClass("xf_register_intext");
                    $("#s_password").addClass("xf_register_intext3");
                    $("#s_password").html("密码符合要求");
                }
            }

            if ($(this).attr("id") == "confirmPassword") {

                if (this.value == "") {
                    $("#s_confirmPassword").removeClass("xf_register_intext");
                    $("#s_confirmPassword").removeClass("xf_register_intext3");
                    $("#s_confirmPassword").addClass("xf_register_intext1");
                    $("#s_confirmPassword").html("请输入确认密码");
                } else if (this.value != $("#password").val()) {
                    $("#s_confirmPassword").removeClass("xf_register_intext");
                    $("#s_confirmPassword").removeClass("xf_register_intext3");
                    $("#s_confirmPassword").addClass("xf_register_intext1");
                    $("#s_confirmPassword").html("两次输入的密码不一致");
                } else {
                    $("#s_confirmPassword").removeClass("xf_register_intext1");
                    $("#s_confirmPassword").removeClass("xf_register_intext");
                    $("#s_confirmPassword").addClass("xf_register_intext3");
                    $("#s_confirmPassword").html("确认密码成功");
                }
            }
            /*
              if($(this).attr("id")=="recommended"){
                  if(this.value != ""){
                  var hasNameExist = #{jsAction @front.account.loginAndRegisterAction.hasNameExist(':name')/}
			  $.post(hasNameExist({name:encodeURI(this.value)}),function(data){
			  	  var arr=eval(data);

				  if(arr.error.code != -2){
				  	 bRecommended = -1;
				  	 $("#s_recommended").removeClass("xf_register_intext");
				     $("#s_recommended").addClass("xf_register_intext1");
			         $("#s_recommended").html("该用户不存在，不能成为推荐人");
				  }else{
				  	 bRecommended = 0;
				  	 $("#s_recommended").removeClass("xf_register_intext1");
				     $("#s_recommended").addClass("xf_register_intext");
				  	 $("#s_recommended").html("推荐人填写正确");
				  }
			  });
		    }
		  }*/
            /*
            if($(this).attr("id")=="code") {

              if(this.value == '') {
                  $("#s_code").html("请输入验证码");
              }else{

                     var randomId = $("#randomID").val();
                     var checkCode = #{jsAction @checkCode(':randomId',':code')/}
	      	  $.post(checkCode({randomId:randomId,code:this.value}),function(data){
		  	  var arr=eval(data);
			  	  if(arr.error.code<0) {
					  $("#s_code").html(arr.error.msg);
					  change()
					  bCode = -1;
					  alert("tt");
			      }else{
			      	  bCode = 0;
			      	  $("#s_code").html("验证码正确");
			      }
	         });

         }
      }*/


        });
    });

    function register() {
        var username = $("#userName").val();

        if (username == '' || username == "建议不用真实姓名作为手机号码") {
            alert("请填写手机号码");
            return;
        } else if (!/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(username)) {
            alert("手机号码不能含有特殊字符");
            return;
        } else if (bName < 0) {
            alert("该手机号码已存在");
            return;
        } else if (!username.isMobileNum()) {
            alert("请输入正确的手机号码");
            return;
        }

        var email = $("#email").val();

        if (email == "") {
            alert("请填写邮箱地址");
            return;
        } else if (!(email).isEmail()) {
            alert("请填写正确的邮箱地址");
            return;
        } else if (bEmail < 0) {
            alert("对不起，该邮箱已存在");
            return;
        }

        var password = $("#password").val();

        if (password == "") {
            alert("请设置您的密码");
            return;
        } else if (password.length < 6) {
            alert("密码长度为6-20个字符");
            return;
        } else if (password.length > 20) {
            alert("密码长度为6-20个字符");
            return;
        } else if (!/^([^\s'‘’]{6,20})$/.test(password)) {
            alert("密码由6-20位字符组成（不含'）");
            return;
        }


        var confirmPassword = $("#confirmPassword").val();
        var code = $("#code").val();

        if (confirmPassword == "") {
            alert("请输入确认密码");
            return;
        } else if (confirmPassword != $("#password").val()) {
            alert("两次输入的密码不一致");
            return;
        }

        if (code == '') {
            alert("请输入验证码");
            return;
        }

        if (!$("#agreement").is(":checked")) {
            alert("注册${currBackstageSet?.platformName}需同意注册协议");
            return;
        }

        if (bRecommended < 0) {
            alert("对不起，该用户不存在，不能成为推荐人");
            return;
        }

        $("#submit").submit();
    }
</script>
